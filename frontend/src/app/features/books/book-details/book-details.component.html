<section class="py-0">
	<div class="container">
		<!-- Card START -->
		<div class="card bg-light overflow-hidden px-sm-5">
			<div class="row align-items-center g-4">

				<!-- Content -->
				<div class="col-sm-9">
					<div class="card-body">
						<!-- Breadcrumb -->
						<nav aria-label="breadcrumb">
							<ol class="breadcrumb breadcrumb-dots mb-0">
								<li class="breadcrumb-item"><a href=""><i class="bi bi-house me-1"></i> Accueil</a></li>
								<li class="breadcrumb-item">Livres</li>
								<li class="breadcrumb-item active">Détails</li>
							</ol>
						</nav>
						
						<!-- Titre -->
						<h1 class="m-0 h2 card-title">Critique du Livre</h1>
					</div>
				</div>	

				<!-- Image -->
				<div class="col-sm-3 text-end d-none d-sm-block">
					<img src="assets/images/element/17.svg" class="mb-n4" alt="">
				</div>
			</div>
		</div>
		<!-- Card END -->
	</div>
</section>

<section>
	<div class="container">
		<div class="row g-4 g-lg-5">	

			<!-- Left side content START -->
			<div class="col-xl-8">
				<div class="vstack gap-5">
					<!-- Book information START -->
					<div class="card shadow">
						<!-- Card header -->
						<div class="card-header p-4 border-bottom">
							<!-- Title -->
							<h3 class="mb-0"><i class="fa-solid fa-book me-2"></i>Informations sur le livre</h3>
						</div>

						<!-- Card body START -->
						<div class="card-body p-4">
							<!-- Card list START -->
							<div class="card mb-4">
								<div class="row align-items-center">
									<!-- Image -->
									<div class="col-sm-6 col-md-3">
                                        <img [src]="book.coverUrl" class="card-img" alt="{{ book.title }}">
									</div>

									<!-- Card Body -->
									<div class="col-sm-6 col-md-9">
										<div class="card-body pt-3 pt-sm-0 p-0">
											<!-- Title -->
											<h5 class="card-title">{{ book.title }}</h5>
											<p class="small mb-2 text-success">{{ book.author }}</p>

											<!-- Rating star -->
											<ul class="list-inline mb-0">
												<li class="list-inline-item me-0 small"><i class="fa-solid fa-star text-warning"></i></li>
												<li class="list-inline-item me-0 small"><i class="fa-solid fa-star text-warning"></i></li>
												<li class="list-inline-item me-0 small"><i class="fa-solid fa-star text-warning"></i></li>
												<li class="list-inline-item me-0 small"><i class="fa-solid fa-star text-warning"></i></li>
												<li class="list-inline-item me-0 small"><i class="fa-solid fa-star-half-alt text-warning"></i></li>
												<li class="list-inline-item ms-2 h6 small fw-bold mb-0">4.5/5.0</li>
											</ul>
										</div>
									</div>

								</div>
							</div>
							<!-- Card list END -->
							
							<!-- Information START -->
							<div class="row g-4">
								<!-- Item -->
								<div class="col-lg-4">
									<div class="bg-light py-3 px-4 rounded-3">
										<h6 class="fw-light small mb-1">Pages</h6>
										<h5 class="mb-1">{{book.pageCount}}</h5>
									</div>
								</div>

								<!-- Item -->
								<div class="col-lg-4">
									<div class="bg-light py-3 px-4 rounded-3">
										<h6 class="fw-light small mb-1">Catégorie</h6>
										<h5 class="mb-1">{{book.category}}</h5>
									</div>
								</div>

								<!-- Item -->
								<div class="col-lg-4">
									<div class="bg-light py-3 px-4 rounded-3">
										<h6 class="fw-light small mb-1">Langue</h6>
										<h5 class="mb-1">{{book.language}}</h5>
									</div>
								</div>
							</div>
							<!-- Information END -->

							<!-- Card START -->
							<div class="card border mt-4">
								<!-- Card header -->
								<div class="card-header border-bottom d-md-flex justify-content-md-between">
									<h5 class="card-title mb-0"><i class="bi bi-patch-check-fill text-success me-2"></i>Description du Livre</h5>
									
								</div>

								<!-- Card body -->
								<div class="card-body">
									
									
									
										<li class="list-group-item h6 fw-light d-flex mb-0">{{book.description}}</li>

                                        
                                          
									
								</div>
                                


								<!-- Review start -->
								<!-- REVIEWS LIST -->
<!-- REVIEWS LIST -->
<!-- REVIEWS LIST -->
<!-- REVIEWS LIST -->
<div>
	<div class="card-header border-bottom d-md-flex justify-content-md-between">
		<h5 class="card-title mb-0"><i class="bi bi-patch-check-fill text-success me-2"></i>Avis</h5>

		<!-- Bouton d’ajout d’avis -->
		<button *ngIf="currentUserEmail && !hasUserReviewed" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addReviewModal">
			<i class="bi bi-plus"></i> Ajouter un avis
		</button>
	</div>
  
	<div class="card-body">
	  <!-- Display Reviews -->
	  <ng-container *ngIf="reviews.length > 0; else noReviews">
		<ul class="list-group list-group-flush">
		  <li
			class="list-group-item h6 fw-light d-flex mb-0 p-3 border-bottom"
			*ngFor="let review of reviews; trackBy: trackByReviewId"
		  >
			<div class="user-profile">
			  <img
				[src]="review.userReviewsDto?.image || 'assets/images/avatar/10.jpg'"
				alt="User Profile"
				class="rounded-circle"
				width="40"
				height="40"
			  />
			</div>
  
			<div class="ms-3 w-100">
			  <div class="d-flex justify-content-between">
				<div>
				  <h6 class="mb-1 fw-bold">
					{{ review.userReviewsDto.firstname }} {{ review.userReviewsDto.lastname }}
				  </h6>
				  <p class="small text-secondary mb-2">{{ review.userReviewsDto.email }}</p>
				</div>
				<div class="text-end">
				  <span class="small text-secondary">
					{{
					  review.updatedAt
						? (review.updatedAt | date: 'MMM d, y, h:mm a')
						: (review.createdAt | date: 'MMM d, y, h:mm a')
					}}
				  </span>
				  <!-- Dropdown shown only if review belongs to current user -->
				  <div class="dropdown ms-2 d-inline-block" *ngIf="isCurrentUserReview(review)">
					<button
					  class="btn btn-sm px-1 py-0"
					  type="button"
					  data-bs-toggle="dropdown"
					  aria-expanded="false"
					>
					  <i class="bi bi-three-dots-vertical"></i>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
					  <li>
						<a
						  class="dropdown-item"
						  href="javascript:void(0)"
						  data-bs-toggle="modal"
						  data-bs-target="#editModal"
						  (click)="selectReview(review)"
						>
						  <i class="bi bi-pencil me-2"></i>Edit
						</a>
					  </li>
					  <li><a class="dropdown-item" href="#"><i class="bi bi-share me-2"></i>Share</a></li>
					  <li><a class="dropdown-item" href="#"><i class="bi bi-flag me-2"></i>Report</a></li>
					  <li><hr class="dropdown-divider" /></li>
					  <li>
						<a
						  class="dropdown-item text-danger"
						  href="javascript:void(0)"
						  data-bs-toggle="modal"
						  data-bs-target="#deleteModal"
						  (click)="selectReview(review)"
						>
						  <i class="bi bi-trash me-2"></i>Delete
						</a>
					  </li>
					</ul>
				  </div>
				</div>
			  </div>
  
			  <div class="rating mb-2" *ngIf="review.rating">
				<span class="fw-bold me-1">{{ review.rating }}</span>
				<i class="bi bi-star-fill text-warning"></i>
			  </div>
  
			  <p class="mb-0">{{ review.content }}</p>
			</div>
		  </li>
		</ul>
	  </ng-container>
  
	  <!-- No Reviews Message -->
	  <ng-template #noReviews>
		<p class="text-center text-muted">Personne n’a encore donné son avis sur ce livre.</p>
	</ng-template>
	</div>
  </div>
  
  <!-- MODALE DE MODIFICATION -->
<div #editModal class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content" *ngIf="selectedReview">
		<div class="modal-header">
		  <h5 class="modal-title">Modifier l'avis</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
		</div>
		<form (ngSubmit)="saveReview()">
		  <div class="modal-body">
			<div class="mb-3">
			  <label class="form-label">Note</label>
			  <div class="star-rating">
				<i
				  *ngFor="let star of [1, 2, 3, 4, 5]"
				  class="bi"
				  [ngClass]="star <= selectedReview.rating ? 'bi-star-fill text-warning' : 'bi-star'"
				  (click)="setRating(star)"
				  style="cursor: pointer; font-size: 1.5rem; margin-right: 5px;"
				></i>
			  </div>
			</div>
			<div class="mb-3">
			  <label class="form-label">Contenu de l'avis</label>
			  <textarea
				class="form-control"
				[(ngModel)]="selectedReview.content"
				name="content"
				rows="4"
			  ></textarea>
			</div>
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
			<button type="submit" class="btn btn-primary">Modifier</button>
		  </div>
		</form>
	  </div>
	</div>
  </div>
  
  <!-- MODALE DE SUPPRESSION -->
  <div #deleteModal class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content" *ngIf="selectedReview">
		<div class="modal-header">
		  <h5 class="modal-title">Confirmer la suppression</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
		</div>
		<div class="modal-body">Êtes-vous sûr de vouloir supprimer cet avis ?</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
		  <button type="button" class="btn btn-danger" (click)="deleteReview()">Supprimer</button>
		</div>
	  </div>
	</div>
  </div>
  
  <!-- MODALE D'AJOUT D'AVIS -->
  <div #addReviewModal class="modal fade" id="addReviewModal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title">Ajouter un avis</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
		</div>
		<form (ngSubmit)="addReview()">
		  <div class="modal-body">
			<div class="mb-3">
			  <label class="form-label">Note</label>
			  <div class="star-rating">
				<i
				  *ngFor="let star of [1, 2, 3, 4, 5]"
				  class="bi"
				  [ngClass]="star <= newReview.rating ? 'bi-star-fill text-warning' : 'bi-star'"
				  (click)="setNewReviewRating(star)"
				  style="cursor: pointer; font-size: 1.5rem; margin-right: 5px;"
				></i>
			  </div>
			</div>
			<div class="mb-3">
			  <label class="form-label">Contenu de l'avis</label>
			  <textarea
				class="form-control"
				[(ngModel)]="newReview.content"
				name="content"
				rows="4"
				required
			  ></textarea>
			</div>
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
			<button type="submit" class="btn btn-primary">Envoyer</button>
		  </div>
		</form>
	  </div>
	</div>
  </div>
  
  <!-- Fin des avis -->
  </div>
  <!-- Fin de la carte -->
  
  </div>
  <!-- Fin du corps de la carte -->
  
  </div>
  <!-- Fin des informations du livre -->
  
  <!-- OPTIONS DE PAIEMENT -->
  
  <!-- Fin des options de paiement -->
  </div>
  </div>
  <!-- Fin du contenu gauche -->
  
  <!-- Début du contenu droit -->
  <aside class="col-xl-4">
	<div class="row g-4">
  
	  <div class="col-md-6 col-xl-12">
		<div class="card shadow">
		  <!-- En-tête de carte -->
		  <div class="card-header border-bottom d-flex justify-content-between align-items-center">
			<h5 class="card-title mb-0">Ajouté par</h5>
			<span class="text-muted small">{{book.addedDate}}</span>
		  </div>
  
		  <!-- Corps de la carte -->
		  <div class="card-body d-flex align-items-center">
			<img alt="avatar" class="avatar-img rounded-circle me-3" style="width: 60px; height: 60px;" [src]="owner?.image ? owner.image : 'assets/images/avatar/10.jpg'">
			<div>
			  <span class="h6 fw-bold">{{owner.firstname}} {{owner.lastname}}</span>
			  <br>
			  <span class="text-muted small">{{owner.email}}</span>
			  <br>
			</div>
		  </div>
		</div>
	  </div>
  
	  <!-- Résumé du prix -->
	  <div *ngIf="!isOwner">
		<app-book-reservation [bookId]="book.id"></app-book-reservation>
	  </div>
	  <!-- Fin du résumé du prix -->
  
	  <!-- Informations -->
	  <div class="col-md-6 col-xl-12">
		<div class="card shadow">
		  <!-- En-tête de la carte -->
		  <div class="card-header border-bottom">
			<h5 class="card-title mb-0">Pourquoi s'inscrire ou se connecter</h5>
		  </div>
  
		  <!-- Corps de la carte -->
		  <div class="card-body">
			<!-- Liste -->
			<ul class="list-group list-group-borderless">
			  <li class="list-group-item d-flex mb-0"><i class="fa-solid fa-check text-success me-2"></i>
				<span class="h6 fw-normal">Accédez à plusieurs livres</span>
			  </li>
			  <li class="list-group-item d-flex mb-0"><i class="fa-solid fa-check text-success me-2"></i>
				<span class="h6 fw-normal">Réservez plus rapidement</span>
			  </li>
			  <li class="list-group-item d-flex mb-0"><i class="fa-solid fa-check text-success me-2"></i>
				<span class="h6 fw-normal">Gérez vos réservations</span>
			  </li>
			</ul>
		  </div>
		</div>
	  </div>
	  <!-- Fin des informations -->
  
	</div>
  </aside>
  <!-- Fin du contenu droit -->
  </div> <!-- Fin de la ligne -->
  </div>
  </section>
  
